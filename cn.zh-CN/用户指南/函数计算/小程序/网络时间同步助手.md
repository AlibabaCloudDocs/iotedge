# 网络时间同步助手 {#task_yxq_1tj_wgb .task}

本文介绍如何通过函数计算部署网络时间同步助手，实现设备本地时间与网络时间同步。如果您的设备上已经安装了NTP服务，有和云端服务器周期性同步系统时间的能力，则无需操作本文内容。

在开始操作本章内容前，请您确保已根据[环境搭建](cn.zh-CN/用户指南/环境搭建/专业版环境搭建/基于Ubuntu 16.04搭建环境.md#)内容创建完成边缘实例。

连接到边缘端的设备，很多Linux系统默认没有安装NTP服务，系统启动后时间常常是从1970年开始计时。或者一些Linux虚拟机只在系统刚启动时做一次时间同步，后续随着系统休眠等情况，虚拟机计时会暂停。随着时间的推移，系统时间与网络时间的差距会越来越大。

当设备本地时间和网络时间不同步时，可能会导致访问云服务失败，也可能导致无法在线安装某些软件。正确的时间戳，对于日志分析也能提供更有价值的参考信息。

您可以通过物联网边缘计算提供的边缘函数计算功能，很好的解决设备本地时间与网络时间不同步的问题。

1.  创建时间同步函数。 
    1.  下载时间同步函数，该函数会自动和NTP服务器同步网络时间。 [syncNetworkTime-code.zip](http://link-iot-edge-packet.oss-cn-shanghai.aliyuncs.com/fc-demo/syncNetworkTime-code.zip) 
    2.  登录阿里云[函数计算控制台](https://www.aliyun.com/product/fc)。 如尚未开通该服务，请阅读并勾选**我已阅读并同意**内容，单击**立即开通**，开通服务。
    3.  单击**服务列表**后的“+”符号，根据界面提示配置参数后，单击**确定**创建一个服务。 其中，**服务名称**必须填写，此处设置为**EdgeFC**，其余参数可根据您的需求设置，也可以不设置。
    4.  创建服务成功后，在服务概览页面单击**函数列表**后的“+”符号，创建函数。
    5.  选择函数模板，此处选择**空白函数**模板。
    6.  在**触发器配置**中，选择**不创建触发器**，单击**下一步**。
    7.  设置数据筛选函数的基础管理配置参数。 

        |参数|描述|
        |--|--|
        |所在服务|选择已创建的EdgeFC服务。|
        |函数名称|设置为**syncNetworkTime**。|
        |运行环境|设置函数的运行环境，此示例中选择nodejs8。|
        |代码配置|选择**代码包上传**，上传已下载的[syncNetworkTime-code.zip](http://link-iot-edge-packet.oss-cn-shanghai.aliyuncs.com/fc-demo/syncNetworkTime-code.zip)代码包。|

        其余参数的值请根据您的需求，参见[函数计算](https://help.aliyun.com/product/50980.html?spm=a2c4g.11186623.2.8.7e6b1617Ezzl6L)设置，也可以不设置。

    8.  单击**下一步**，进入模板授权管理页面。此处无需设置，单击**下一步**。
    9.  确认函数信息后，单击**创建**。 创建函数完成后，单击函数名称，可在**代码执行**页签下查看源码。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/129964/155626577939393_zh-CN.png)

2.  分配函数到边缘实例。 
    1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。
    2.  左侧导航栏选择**边缘计算** \> **边缘实例**。
    3.  在[前提条件](#)中完成的边缘实例右侧，单击**查看**。
    4.  在实例详情页面，选择**函数计算**，单击**分配函数**。
    5.  在分配函数页面中，将已创建的时间同步函数**syncNetworkTime**分配到边缘实例中。 参数说明如下：

        |参数|描述|
        |--|--|
        |地域|选择您创建的服务所在的地域。|
        |服务|选择**EdgeFC**服务。|
        |函数|选择**syncNetworkTime**函数。|
        |授权|选择**AliyunIOTAccessingFCRole**。|

    6.  单击**分配**，然后配置函数。 

        |参数|描述|
        |--|--|
        |运行模式|运行模式有两种。此处选择**持续运行**模式。程序部署后会立即执行。|
        |内存限制|函数运行可使用的内存资源上限，单位为MB。此处设置为512 MB。当函数使用内存超出该限制时，该函数计算程序会被强制重启。|
        |超时限制|函数收到事件后的最长处理时间，此处使用默认值5秒。如超过该时间函数仍未返回结果，该函数计算程序将会被强制重启。|
        |定时运行|单击开关按钮，打开定时运行，文本框中填入`* * * * *`。表示该函数会被定时触发运行，每分钟执行一次。Cron表达式详细信息请参考[详细表达式](https://yuque.antfin-inc.com/aone683673/link-iot-edge-doc/fcaccessoss)内容。|

        单击**确定**，至此您已将时间同步函数分配到边缘实例中。

3.  部署边缘实例并查看设备的运行结果。 

    1.  在实例详情页面，单击右上角**部署**后在弹出框中单击**确定**，将子设备、函数计算下发到边缘端。 您可以通过单击**部署详情**来查看部署进度及结果。
    2.  实例部署成功后，在网关上执行`date`命令查看系统的本地时间。此时网关的系统时间应该和网络时间一致。
    至此您已经完整地体验了使用边缘函数计算实现网络时间同步的功能。


