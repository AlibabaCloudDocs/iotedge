# 搭建边缘环境 {#concept_u5m_hkq_32b .concept}

本章介绍部署边缘计算节点的方法，边缘计算节点是作为网关设备，用于将设备连接到物联网平台中。

## 高级版部署流程

高级版使用使用Linke iot Edge的docker镜像部署，要求CPU架构为x86_64，docker宿主机操作系统为linux，目前在以下系统中搭建边缘环境已通过验证：  
- Ubuntu 16.04, Ubuntu 18.04, Windows7, Windows8, Windows10, MAC  

下面介绍这几个环境下的部署流程，其他环境下可参考此流程部署

### 安装Docker {#section_ojq_gry_32b .section}

- Ubuntu环境，shell下执行 `wget -qO- https://get.docker.com/ | sh`
- Windows7及Windows8环境：  
    方法一：安装docker toolbox，参照[docker toolbox安装指导](https://docs.docker.com/toolbox/toolbox_install_windows)  
    方法二：先安装virtualbox，在virtualbox中安装ubuntu18.04，再参照ubuntu环境的docker安装方法安装docker  
- Window10环境参照[Windows10版docker安装指导](https://docs.docker.com/docker-for-windows/install)  
- MAC环境参照[MAC版docker安装指导](https://docs.docker.com/docker-for-mac/install)

### 创建边缘网关 {#section_wzw_3fz_gfb .section}

1.  以阿里云账号登录[物联网控制台](http://iot.console.aliyun.com/)。
2.  选择**设备管理** \> **产品**，单击**创建产品**。
3.  选择创建**高级版**产品，单击**下一步**，创建名为**边缘计算节点**的网关产品。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15286/15450099056712_zh-CN.png)

    按照界面提示，设置如下参数，参数设置完成后，单击**完成**创建网关产品。

    |参数|描述|
    |--|--|
    |产品名称|此处设置为**边缘计算节点**。|
    |所属分类|此处选择**边缘计算** \> **边缘网关**。|
    |节点类型|此处选择**网关**。|
    |数据格式|设备上下行的数据格式，此处选择**ICA 标准数据格式 \(Alink JSON\)**。Alink JSON是物联网平台高级版为开发者提供的设备与云端的数据交换协议，采用 JSON 格式。|
    |产品描述|您可以自定义，可以为空。|

4.  选择**设备管理** \> **设备**，单击**添加设备**，为**边缘计算节点**添加设备。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15286/15450099056713_zh-CN.png)

    按照界面提示，设置如下参数，参数设置完成后，单击**确认**创建网关设备。

    |参数|描述|
    |--|--|
    |产品|选择已创建的**边缘计算节点**产品。|
    |DeviceName|此处设置网关设备名称为gateway。|

    网关设备添加成功后，请本地保存设备证书信息（ProductKey、DeviceName、DeviceSecret），以备后续部署网关时使用。


### 安装并启动边缘计算节点 {#section_ixl_bff_j2b .section}

1.  下载[启动脚本](http://aliyun-iotedge.oss-cn-hangzhou.aliyuncs.com/link-iot-edge.sh)  
    
    该脚本会去拉取Link iot Edge的docker镜像，并使用该镜像启动一个容器。可以把文件先下载下来在拷贝到合适目录，或者也可以直接在shell下执行：  
    `wget http://aliyun-iotedge.oss-cn-hangzhou.aliyuncs.com/link-iot-edge.sh`  
    或`curl -O http://aliyun-iotedge.oss-cn-hangzhou.aliyuncs.com/link-iot-edge.sh`

2.  启动边缘计算节点

    ./link-iot-edge.sh $(version) $(pk) $(dn) $(ds)
    
    **注意：**  
    - 如果脚本没有执行权限，请先执行`$ chmod +x ./link-iot-edge.sh`命令授权后再执行上面的命令。
    
    **说明：**  
    - 请将$(version)替换为需要的Docker镜像版本号，此处替换为v1.8。
    - 请将$(pk) $(dn) $(ds)替换为已在本地保存的gateway网关设备的设备证书信息。
    
3. 确认网关上线  

    在[物联网控制台](http://iot.console.aliyun.com/)，选择**设备管理** \> **设备**，选择已创建好的边缘计算节点产品，查看网关状态。  
    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15286/15450099056743_zh-CN.png)

## 基础版及标准版部署流程  

基础版及标准版使用Link iot Edge自包含包部署，要求运行环境为linux 64位系统，CPU架构支持：
- x86_64, ARMv7, ARMv7-hf, ARMv8  

1、根据CPU架构获取相应的Link iot Edge自包含包  
2、将自包含包解压到根目录：  

    `tar -zxvf $(package) -C /`  
3、启动边缘网关  

    `cd /linkedge/gateway/build/script/ && ./iot_gateway_start.sh && cd ../bin/ && ./tool_config -g3 $(pk) $(dn) $(ds) && cd ../script && ./iot_gateway_start.sh`  
请将$(pk) $(dn) $(ds)替换为已在本地保存的gateway网关设备的设备证书信息。


